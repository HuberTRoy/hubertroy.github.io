import{r as e,o as t,a,c as o,b as s,n as i,d as r,e as l,f as n}from"./vendor.f58206f9.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var d=(e,t)=>{for(const[a,o]of t)e[a]=o;return e};const c=function(){const e=document.createElement("a");return document.body.appendChild(e),function(t,a){let o=window.URL.createObjectURL(t);e.href=o,e.download=a,e.click(),window.URL.revokeObjectURL(o)}}(),u={class:"vue-cropper"},f={class:"vue-cropper-cardbg",ref:"cardBg"},h={class:"vue-cropper-modal",ref:"cardModal"},g={class:"vue-cropper-clip-image",ref:"clipImage"};var p=d({props:{image:{type:String,required:!0},width:{type:Number,required:!1,default:500},height:{type:Number,required:!1,default:300}},setup(a,{emit:o}){let s=document.createElement("canvas"),i=e(s),r=e(s),l=e(),n=e({width:"0",height:"0",left:"0",top:"0",border:"1px solid #1E9EFB"}),d=e(s),u=e(!1),f=e("topcenter"),h=e(!1),g={baseOffsetX:0,baseOffsetY:0,w:180,h:180};const p=()=>{n.value.width=`${Math.abs(g.w)}px`,n.value.height=`${Math.abs(g.h)}px`,n.value.left=`${g.baseOffsetX}px`,n.value.top=`${g.baseOffsetY}px`,(()=>{let e=r.value.getContext("2d");e.clearRect(0,0,a.width,a.height),e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(0,0,a.width,a.height)})();let e=r.value.getContext("2d");e.save(),e.beginPath(),e.globalCompositeOperation="destination-out",e.fillStyle="black",e.fillRect(g.baseOffsetX,g.baseOffsetY,g.w,g.h),e.fill(),e.closePath(),e.restore(),v()},v=()=>{let e=i.value.getContext("2d").getImageData(g.w<0?g.baseOffsetX+g.w:g.baseOffsetX,g.h<0?g.baseOffsetY+g.h:g.baseOffsetY,Math.abs(g.w),Math.abs(g.h)),t=d.value.getContext("2d");d.value.width=g.w,d.value.height=g.h,t.putImageData(e,0,0,0,0,g.w,g.h)},m=({imageWidth:e,imageHeight:t,width:a,height:o,base:s=1})=>e/s<a&&t/s<o?{imageWidth:e/s,imageHeight:t/s}:m({imageWidth:e,imageHeight:t,width:a,height:o,base:s+.1}),b=e=>{let t=e.target;i.value.width=a.width,i.value.height=a.height,r.value.width=a.width,r.value.height=a.height;let o=i.value.getContext("2d"),{imageWidth:s,imageHeight:l}=m({imageWidth:t.width,imageHeight:t.height,width:a.width,height:a.height});o.drawImage(t,0,0,t.width,t.height,(a.width-s)/2,(a.height-l)/2,s,l),g={baseOffsetX:(a.width-s)/2,baseOffsetY:(a.height-l)/2,w:s,h:l},p()},w=()=>{a.image&&(()=>{let e=new Image;e.src=a.image,e.onload=b})()};return t((()=>{w()})),{cardBg:i,cardModal:r,clip:l,clipStyle:n,clipImage:d,dotDown:u,clipDown:h,cardMouseMove:e=>{if(!u.value&&!h.value)return;const{offsetX:t,offsetY:a}=e,o=()=>{e.target===r.value?a<g.baseOffsetY&&(g.h+=g.baseOffsetY-a,g.baseOffsetY=a):e.target===l.value&&(g.h-=a,g.baseOffsetY+=a)},s=()=>{e.target===r.value?a>g.baseOffsetY&&(g.h=a-g.baseOffsetY):e.target===l.value&&(g.h=a)},i=()=>{e.target===r.value?t<g.baseOffsetX&&(g.w+=g.baseOffsetX-t,g.baseOffsetX=t):e.target===l.value&&(g.w-=t,g.baseOffsetX+=t)},n=()=>{e.target===r.value?t>g.baseOffsetX&&(g.w=t-g.baseOffsetX):e.target===l.value&&(g.w=t)},d={topcenter:()=>{o()},bottomcenter:()=>{s()},leftcenter:()=>{i()},rightcenter:()=>{n()},bottomright:()=>{n(),s()},bottomleft:()=>{i(),s()},topright:()=>{n(),o()},topleft:()=>{i(),o()}};u.value&&d[f.value](),h.value&&!u.value&&(g.baseOffsetX=g.baseOffsetX+e.movementX,g.baseOffsetY=g.baseOffsetY+e.movementY),p()},register:e=>{u.value=!0,f.value=e},exportImg:async()=>{let e=d.value.toDataURL("image/png");o("dataURIChange",e);let t=await function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),s=new Uint8Array(o),i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return new Blob([o],{type:a})}(e);o("blobChange",t),c(t,"data.png")}}}},[["render",function(e,t,r,l,n,d){return a(),o("div",u,[s("div",{class:"vue-cropper-card",onMouseup:t[10]||(t[10]=e=>{l.clipDown=!1,l.dotDown=!1}),onMousemove:t[11]||(t[11]=(...e)=>l.cardMouseMove&&l.cardMouseMove(...e)),style:i({width:`${r.width}px`,height:`${r.height}px`})},[s("canvas",f,null,512),s("canvas",h,null,512),s("div",{class:"vue-cropper-clip",ref:"clip",style:i(l.clipStyle),onMousedown:t[8]||(t[8]=e=>l.clipDown=!0),onMouseup:t[9]||(t[9]=e=>l.clipDown=!1)},[s("div",{class:"dot top-left",onMousedown:t[0]||(t[0]=e=>l.register("topleft"))},null,32),s("div",{class:"dot top-right",onMousedown:t[1]||(t[1]=e=>l.register("topright"))},null,32),s("div",{class:"dot top-center",onMousedown:t[2]||(t[2]=e=>l.register("topcenter"))},null,32),s("div",{class:"dot bottom-left",onMousedown:t[3]||(t[3]=e=>l.register("bottomleft"))},null,32),s("div",{class:"dot bottom-center",onMousedown:t[4]||(t[4]=e=>l.register("bottomcenter"))},null,32),s("div",{class:"dot bottom-right",onMousedown:t[5]||(t[5]=e=>l.register("bottomright"))},null,32),s("div",{class:"dot left-center",onMousedown:t[6]||(t[6]=e=>l.register("leftcenter"))},null,32),s("div",{class:"dot right-center",onMousedown:t[7]||(t[7]=e=>l.register("rightcenter"))},null,32)],36)],36),s("canvas",g,null,512),s("div",null,[s("button",{onClick:t[12]||(t[12]=(...e)=>l.exportImg&&l.exportImg(...e))},"save")])])}]]);n(r({setup:e=>(e,t)=>(a(),l(p,{image:"./src/assets/gouzi.jpeg"},null,8,["image"]))})).mount("#app");
